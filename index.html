<div id="silent-auction" style="font-family: sans-serif; padding: 1em; background: #f5f5f5; border: 1px solid #ccc; border-radius: 6px;">
  <h3 style="margin-top: 0;">Silent Auction</h3>
  <p><strong>Highest Bid:</strong> <span id="highest-bid">Loading...</span></p>

  <form id="bid-form" style="margin-top: 1em;">
    <input type="text" id="bid-name" placeholder="Your name" required style="margin-bottom: 0.5em; width: 100%; padding: 0.5em;" />
    <input type="email" id="bid-email" placeholder="Your email" required style="margin-bottom: 0.5em; width: 100%; padding: 0.5em;" />
    <input type="number" id="bid-amount" placeholder="Your bid ($)" step="0.01" required style="margin-bottom: 0.5em; width: 100%; padding: 0.5em;" />
    <button type="submit" style="padding: 0.7em 1.2em; background: black; color: white; border: none; cursor: pointer;">Submit Bid</button>
  </form>

  <p id="bid-response" style="margin-top: 1em; color: green; display: none;"></p>
</div>

<script>
  const product = "Chronoformosis"; // Replace this with your actual product name
  const highestBidEl = document.getElementById('highest-bid');
  const bidForm = document.getElementById('bid-form');
  const responseEl = document.getElementById('bid-response');

  const apiBase = "https://silent-auction-vert.vercel.app/api/bid"; // ✅ fixed endpoint

  async function loadHighestBid() {
    try {
      const res = await fetch(`${apiBase}?product=${encodeURIComponent(product)}`);
      const data = await res.json();
      if (data.highestBid) {
        highestBidEl.textContent = `$${parseFloat(data.highestBid.bidAmount).toFixed(2)} by ${data.highestBid.name}`;
      } else {
        highestBidEl.textContent = "No bids yet.";
      }
    } catch (err) {
      highestBidEl.textContent = "Unable to load.";
    }
  }

  bidForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('bid-name').value.trim();
    const email = document.getElementById('bid-email').value.trim();
    const bidAmount = document.getElementById('bid-amount').value.trim();

    const res = await fetch(apiBase, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, bidAmount, product })
    });

    const result = await res.json();
    if (result.success) {
      responseEl.style.color = 'green';
      responseEl.textContent = "✅ Your bid has been placed!";
      responseEl.style.display = 'block';
      bidForm.reset();
      loadHighestBid();
    } else {
      responseEl.style.color = 'red';
      responseEl.textContent = "❌ " + (result.error || "Something went wrong.");
      responseEl.style.display = 'block';
    }
  });

  loadHighestBid();
</script>
